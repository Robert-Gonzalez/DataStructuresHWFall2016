# Makefile for ChunkySting Tester
# 
# As usual, you can build this software by typing
#
#     make
#

# ----- Make Macros -----

CXXFLAGS    =	-g -stdlib=libc++ -std=c++11 -Wall -Wextra -pedantic 
CXX	    =	clang++

TARGETS 	    =	stringtest stringtest-ours stringtest-ours-2 messagepasser
STRINGTEST_OBJS     =	chunkystring.o stringtest.o testing-logger.o
STRINGTEST_OURS     =	 testing-logger.o stringtest-ours.o chunkystring.o
STRINGTEST_OURS_2     =	 testing-logger.o stringtest-ours-2.o chunkystring.o
MESSAGEPASSER_OBJS  =   chunkystring.o message-passer.o noisy-transmission.o
ALL_OBJS	    =   $(STRINGTEST_OBJS) $(MESSAGEPASSER_OBJS) $(STRINGTEST_OURS) $(STRINGTEST_OBJS_2)


# ----- Make Rules -----

all:	$(TARGETS)

test: stringtest stringtest-ours stringtest-ours-2
	./stringtest;./stringtest-ours;./stringtest-ours-2

stringtest:	$(STRINGTEST_OBJS)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(STRINGTEST_OBJS) \
		$(LIBS)

stringtest-ours: $(STRINGTEST_OURS) 
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(STRINGTEST_OURS) \
	    $(LIBS)

stringtest-ours-2: $(STRINGTEST_OURS_2) 
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(STRINGTEST_OURS_2) \
	    $(LIBS)

messagepasser:	$(MESSAGEPASSER_OBJS)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o $@ -lpthread $(MESSAGEPASSER_OBJS) \
		$(LIBS)

clean:
	rm -f $(TARGETS) $(ALL_OBJS)

# ---- Dependencies (generated by typing ``clang++ -MM *.cpp'') ----

testing-logger.o: testing-logger.hpp testing-logger.cpp
stringtest.o: stringtest.cpp chunkystring.hpp iterator-private.hpp
stringtest-ours.o: stringtest-ours.cpp
chunkystring.o: chunkystring.cpp chunkystring.hpp iterator-private.hpp
noisy-transmission.o: chunkystring.cpp chunkystring.hpp iterator-private.hpp noisy-transmission.cpp noisy-transmission.hpp
message-passer.o: chunkystring.cpp chunkystring.hpp iterator-private.hpp noisy-transmission.cpp noisy-transmission.hpp

